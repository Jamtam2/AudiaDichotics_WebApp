<!-- Add a button to initiate checkout -->
<%# <button id="checkout-button">Pay $4500</button> %>
<%= button_to 'Pay $4500', stripe_checkout_path, method: :post, id: 'checkout-button', class: 'btn btn-primary', remote: true, data: { stripe_public_key: ENV['PUBLIC_KEY_TEST'] ***REMOVED*** %>
<!-- Include Stripe.js -->
<script src="https://js.stripe.com/v3/"></script>

<script>
  // First, find the button by its ID
  let checkoutButton = document.getElementById('checkout-button'***REMOVED***;

  // Then, retrieve the public key from the data attribute of the button
  var publicKeyTest = checkoutButton.getAttribute('data-stripe-public-key'***REMOVED***;

  // Initialize Stripe with the public key
  var stripe = Stripe(publicKeyTest***REMOVED***;

  const csrfToken = document.querySelector('meta[name="csrf-token"]'***REMOVED***.getAttribute('content'***REMOVED***;
  
  checkoutButton.addEventListener('click', function (***REMOVED*** {
    fetch('/stripe_checkout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRF-Token': csrfToken // Include the CSRF token in the request header
      ***REMOVED***,
      credentials: 'same-origin' // Ensure cookies (including CSRF token***REMOVED*** are sent with the request
    ***REMOVED******REMOVED***
    .then(function (response***REMOVED*** {
      return response.json(***REMOVED***;
    ***REMOVED******REMOVED***
    .then(function (session***REMOVED*** {
      return stripe.redirectToCheckout({ sessionId: session.id ***REMOVED******REMOVED***;
    ***REMOVED******REMOVED***
    .catch(function (error***REMOVED*** {
      console.error('Error:', error***REMOVED***;
    ***REMOVED******REMOVED***;
  ***REMOVED******REMOVED***;
</script>
