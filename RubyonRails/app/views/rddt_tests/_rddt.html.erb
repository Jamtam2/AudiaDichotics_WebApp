<!--Test page for RDDT List 1 Contains everything for completing and submitting a test  -->
<!--this tests interpretation is identical to DWT just with different normative values, NOTE: the interpretation and ear advantge is only based on the 2 button pairs and no others-->
<body id= "defBG">
  <div class="container p-5 my-3 w-100 border rounded bg-white ">

    <div data-list-type=<%= data_list_type%> ></div>

    <h1 class= "display-5", style= 'padding-bottom:20px' ><strong><%= "Testing " + @client.first_name + " " + @client.last_name%></strong></h1>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    
    <!--Test page for RDDT List 1 Contains everything for completing and submitting a test  -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

    <style>
      div.sticky {
        position: -webkit-sticky; /* Safari */
        position: sticky;
        top: 0;
      }
    </style>

    <div class="container">
      <%= form_with model: [@client, @rddt_test], local: true, html: { multipart: true } do |f| %>
        <%= f.hidden_field :category_id, value: @rddt_test.category_id %>
        <div class="row">
          <div class="form-group row">
            <div class="col-sm">
              <div class="form-group row ">
                <label for="exampleLabel">Label</label>
                <%= f.text_field :label, class: "form-control", type: "text", id: "exampleLabel", value: example_label %>
              </div>
              <div class="form-group row ">
                <label for="clientName">Client</label>
                <input class="form-control" type="text" id="clientName" placeholder="<%= @client.first_name + ' ' + @client.last_name %>" readonly />
              </div>
              <div class="form-group row ">
                <label for="testType">Type</label>
                <input class="form-control" type="text" id="testType" placeholder="RDDT" readonly />
              </div>
              <hr/>

              <div class="form-group row ">
                <label for="conditionSelect">Condition</label>
                <input class="form-control" type="text" id="conditionSelect" placeholder="" readonly>
              </div>
              <hr/>
    
              <div class="sticky">
                <p>Notes</p>
                <%= f.text_area :notes, class: 'form-control', rows: '3' %>
                <hr/>
                
                <!--AUDIO PLAYER FOR AUDIO FILES STORED IN ASSETS/AUDIO/ETC.MP3-->
                <audio id="audioPlayer">
                  <source src="<%= asset_path(audio_asset) %>" type="<%= audio_type %>" />
                </audio>
                
                <!-- AUDIO PLAYER CONTROLS -->
                <button id="startAudioBtn" type="button" class="btn btn-info" disabled>Start Audio</button>
                <button id="stopAudioBtn" type="button" class="btn btn-info" disabled>Stop Audio</button>
                <span id="audioTimeContainer"><i>Loading...</i></span>
                <hr/>

                <!--Table for ear advantage percentage that is calculated in the script-->
                <style>
                  .left-column {
                    background-color: lightblue;
                  }

                  .right-column {
                    background-color: lightpink;
                  }

                  .ear-advantage {
                    background-color: white;
                  }

                  .ear-advantage.positive {
                    background-color: lightblue;
                  }

                  .ear-advantage.negative {
                    background-color: lightpink;
                  }
                </style>


                <p>Scores:</p>
                <table class="table table-sm table-bordered m1-4" style="max-width: 25rem;">
                  <thead>
                    <tr>
                      <th scope="col">Pairs</th>
                      <th scope="col">Left</th>
                      <th scope="col">Right</th>
                      <th scope="col">Ear Adv</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th scope="row">1</th>
                      <td class="left-column"><span id="column1Group1-percent">0</span>%</td>
                      <td class="right-column"><span id="column2Group1-percent">0</span>%</td>
                      <td class="ear-advantage"><span id="Group1advantage-Diff">0</span>%</td>
                    </tr>
                    <tr>
                      <th scope="row">2</th>
                      <td class="left-column"><span id="column1Group2-percent">0</span>%</td>
                      <td class="right-column"><span id="column2Group2-percent">0</span>%</td>
                      <td class="ear-advantage"><span id="Group2advantage-Diff">0</span>%</td>
                    </tr>
                    <tr>
                      <th scope="row">3</th>
                      <td class="left-column"><span id="column1Group3-percent">0</span>%</td>
                      <td class="right-column"><span id="column2Group3-percent">0</span>%</td>
                      <td class="ear-advantage"><span id="Group3advantage-Diff">0</span>%</td>
                    </tr>
                  </tbody>
                </table>
            
                <!--Table for ear advantage that is calculated in the script and ear diagnosis/interpretation-->
                <label for="read-Only">Ear Advantage</label>
                <input class="form-control" type="text" id="read-Only" value="" readonly>
                <span hidden id="advantage-Name"></span>
                <label for="read-Only">Interpretation</label>
                <input class="form-control" type="text" id="read-Only-diag" value="" readonly>
                <span hidden id="Diagnosis"></span>
                <hr/>

                <p>Percentile of Scores:</p>
                <table class="table table-sm table-bordered m1-4" style="max-width: 25rem;">
                  <thead>
                    <tr>
                      <th scope="col">Left Ear</th>
                      <th scope="col">Right Ear</th>
                      <th scope="col">Ear Advantage</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td class="percentile"><span id="left-percentile"></span></td>
                      <td class="percentile"><span id="right-percentile"></span></td>
                      <td class="percentile"><span id="advantage-percentile"></span></td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <style>
            /* Center buttons in the table cells */
            .btn-group-toggle {
              display: flex;
              justify-content: center;
              align-items: center;
              height: 100%;
            }

            /* Make the font larger */
            .btn.btn-outline-primary {
              font-size: 16px; /* Adjust the font size as needed */
              margin: 5px; /* Add some margin to separate the buttons */
              min-width: 40px; /* Adjust the minimum width as needed */
            }
          </style>

          <div class="col-sm">
            <table class="table table-sm table-striped ml-4">
              <thead class="thead-dark">
                <tr>
                  <th>Number</th>
                  <th>Left</th>
                  <th>Right</th>
                </tr>
              </thead>

              <tbody>
                <!-- Loop for table of numbers and creation of all buttons, only loops 54 times and creates table for buttons-->
                <% 54.times do |i| %>
                  <tr>
                    <td><%= i + 1 %></td>

                    <td>
                      <div class="btn-group-toggle" data="buttons">
                        <% group_size = nums[i][0].length %>
                        <% nums[i][0].each_with_index do |num, index| %>
                          <% button_class = "column1Group#{group_size}-button" %>
                          <label class="btn btn-outline-primary <%= button_class %>">
                            <input type="checkbox" name="selected_words[<%= i %>][]" value="<%= num %>" />
                            <%= num %>
                          </label>
                        <% end %>
                      </div>
                    </td>

                    <td>
                      <div class="btn-group-toggle" data="buttons">
                        <% group_size = nums[i][1].length %>
                        <% nums[i][1].each_with_index do |num, index| %>
                          <% button_class = "column2Group#{group_size}-button" %>
                          <label class="btn btn-outline-primary <%= button_class %>">
                            <input type="checkbox" name="selected_words[<%= i %>][]" value="<%= num %>" />
                            <%= num %>
                          </label>
                        <% end %>
                      </div>
                    </td>

                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
          
        <!-- Existing form fields -->
        <%= f.hidden_field :client_name, value: "Example user" %>
        <%= f.hidden_field :test_type, value: "RDDT" %>
        <%= f.hidden_field :left_score2, id: "left_score" %>
        <%= f.hidden_field :right_score2, id: "right_score" %>
        <%= f.hidden_field :ear_advantage, id: "ear_advantage" %>
        <%= f.hidden_field :ear_advantage_score, id: "ear_advantage_score" %>

        <%= f.hidden_field :left_score1, id: "col1G1" %>
        <%= f.hidden_field :right_score1, id: "col2G1" %>
        <%= f.hidden_field :left_score3, id: "col1G3" %>
        <%= f.hidden_field :right_score3, id: "col2G3" %>
        <%= f.hidden_field :ear_advantage_score1, id: "ear_advantage_score1" %>
        <%= f.hidden_field :ear_advantage_score3, id: "ear_advantage_score3" %>

        <%= f.hidden_field :G1adv, id: "G1adv" %>
        <%= f.hidden_field :G3adv, id: "G3adv" %>

        <%= f.hidden_field :interpretation, id: "interpretation" %>
        <%= f.hidden_field :left_percentile, id: "left_percentile" %>
        <%= f.hidden_field :right_percentile, id: "right_percentile" %>
        <%= f.hidden_field :advantage_percentile, id: "advantage_percentile" %>

        <%= f.submit "Submit", class: "btn btn-primary btn-block", onclick: "populateHiddenFields()" %>
      <% end %>

      <!--this is just a storage of variable in the html outside of the js so that they can be pulled to the forms above -->
      <div>
        <p><span hidden id="column1-count"></span></p>
        <p><span id="column1Group1-percent"></span></p>
        <p><span id="column1Group2-percent"></span></p>
        <p><span id="column1Group3-percent"></span></p>

        <p><span hidden id="column2-count"></span></p>
        <p><span id="column2Group1-percent"></span></p>
        <p><span id="column2Group2-percent"></span></p>
        <p><span id="column2Group3-percent"></span></p>

        <p><span id="Group1advantage-Diff"></span></p>
        <p><span id="Group2advantage-Diff"></span></p>
        <p><span id="Group3advantage-Diff"></span></p>
        <p><span id="left-percentile"></span></p>
        <p><span id="right-percentile"></span></p>
        <p><span id="advantage-percentile"></span></p>
      </div>
    </div>
  </div>
  
  <div id="client-data" data-age="<%= @client.age_in_years %>"></div>
  <%= javascript_pack_tag 'rddt_script' %>

  </body>
</html>
