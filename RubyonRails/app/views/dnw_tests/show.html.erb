<body id= "defBG">


<!--DNW Test Show page, displays data in 3 columns so its easy for clinicians to review and understand the scores gotten -->

<div class="container p-5 my-3 w-100 bg-white border-0">
<h1 class="display-3 pl-4", style= 'padding-top:20px'><b><%= @dnw_test.test_type%> Test Results</b></h1>
<hr>
<!--This contains the 3 rows for the data stored on the page all test scores are pulled from the dnw test model -->

<div class="container">
    <div class="row">
        <div class="col-sm">
            <h2 class="pt-5", style= 'padding-top:20px'><center><b>Left Ear Score</b></center></h2>
            <h2 class="display-4", style= 'padding-top:20px'><center><b><%= @dnw_test.left_score%>%</b></center></h2>

        </div>
        <div class="col-sm">
            <%= image_tag 'person.png', class: 'w-40 img-responsive center-block', style: 'max-width: 20rem;' %>
        </div>
        <div class="col-sm">
            <h2 class="pt-5", style= 'padding-top:20px'><center><b>Right Ear Score</b></center></h2>
            <h2 class="display-4 "pl-4"", style= 'padding-top:20px'><center><b><%= @dnw_test.right_score%>%</b></center></h2>

        </div>
    </div>
<div>

<!--Data stored outside of the columns with the image -->
<!--Data stored outside of the columns with the image -->
    <style>
      /* Center buttons in the table cells */
      .btn-group-toggle {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100%;
      }

      /* Make the font larger */
      .btn.btn-outline-primary {
        font-size: 16px; /* Adjust the font size as needed */
        margin: 5px; /* Add some margin to separate the buttons */
        min-width: 40px; /* Adjust the minimum width as needed */
      }
    </style>


<% if @dnw_test.selected_words.present? %>

<h3>Selected Words</h3>
<table class="table table-sm table-striped ml-4" style="max-width: 25rem;">
  <thead class="thead-dark">
    <tr>
      <th>Number</th>
      <th>Left</th>
      <th>Right</th>
    </tr>
  </thead>
  <tbody>
    <% words_list = case @dnw_test.category_id
                   when 1
                     [
                        ["Beeth", "Ked"],
                        ["Dith", "Feev"],
                        ["Thich", "Yob"],
                        ["Yid", "Jeek"],
                        ["Duth", "Pel"],
                        ["Koid", "Zuth"],
                        ["Poim", "Zug"],
                        ["Choid", "Thooch"],
                        ["Boap", "Rudge"],
                        ["Looth", "Sich"],
                        ["Veb", "Zite"],
                        ["Jeeth", "Koom"],
                        ["Chiv", "Feek"],
                        ["Beev", "Zoil"],
                        ["Meeth", "Wid"],
                        ["Vich", "Zayg"],
                        ["Widge", "Zuch"],
                        ["Choog", "Zith"],
                        ["Vum", "Waf"],
                        ["Meech", "Zoth"],
                        ["Futh", "Zoop"],
                        ["Keek", "Noof"],
                        ["Kich", "Weeth"],
                        ["Mayp", "Tith"],
                        ["Maych", "Veeb"]
                     ]
                   when 2
                     [
                        ["Baf", "Peth"],
                        ["Fooz", "Roip"],
                        ["Thooz", "Zidge"],
                        ["Sach", "Wuv"],
                        ["Juf", "Zoid"],
                        ["Gatch", "Soodge"],
                        ["Chudge", "Mog"],
                        ["Baym", "Dus"],
                        ["Jich", "Soik"],
                        ["Moit", "Poodge"],
                        ["Roodge", "Voich"],
                        ["Goid", "Mudge"],
                        ["Fide", "Theech"],
                        ["Kooth", "Meed"],
                        ["Mooz", "Voidge"],
                        ["Bidge", "Vuch"],
                        ["Poin", "Voodge"],
                        ["Poith", "Wook"],
                        ["Sudge", "Waym"],
                        ["Gitch", "Thoon"],
                        ["Nuch", "Thoom"],
                        ["Ludge", "Woit"],
                        ["Jov", "Thaun"],
                        ["Nooch", "Ruv"],
                        ["Roit", "Vob"]
                     ]
                   when 3
                     [
                        ["Yach", "Chuz"],
                        ["Vib", "Zoog"],
                        ["Nov", "Wudge"],
                        ["Chaz", "Voot"],
                        ["Bap", "Pum"],
                        ["Goug", "Voch"],
                        ["Feeg", "Vudge"],
                        ["Roif", "Jeeb"],
                        ["Sooch", "Tuv"],
                        ["Fuv", "Shat"],
                        ["Suth", "Kosh"],
                        ["Dudge", "Jooch"],
                        ["Chid", "Dadage"],
                        ["Pooth", "Kef"],
                        ["Choom", "Thit"],
                        ["Thoodge", "Vus"],
                        ["Voin", "Zam"],
                        ["Boich", "Juv"],
                        ["Jath", "Hod"],
                        ["Joov", "Kes"],
                        ["Bith", "Puv"],
                        ["Voth", "Yim"],
                        ["Toodge", "Yich"],
                        ["Jith", "Yoip"],
                        ["Gid", "Jayv"]
                     ]
                   when 4
                     [
                        ["Zayf", "Soob"],
                        ["Voof", "Kun"],
                        ["Chach", "Jit"],
                        ["Fav", "Moidge"],
                        ["Feg", "Suv"],
                        ["Jach", "Sooog"],
                        ["Nib", "Fek"],
                        ["Ves", "Booch"],
                        ["Sahdge", "Zoid"],
                        ["Tooz", "Yite"],
                        ["Chud", "Vil"],
                        ["Golf", "Tich"],
                        ["Luf", "Bok"],
                        ["Moich", "Juth"],
                        ["Gudge", "Veth"],
                        ["Joob", "Vath"],
                        ["Jike", "Foob"],
                        ["Bime", "Choif"],
                        ["Wov", "Jat"],
                        ["Chayg", "Foich"],
                        ["Wode", "Roiz"],
                        ["Juch", "Faz"],
                        ["Puz", "Douth"],
                        ["Wolf", "Gez"],
                        ["Joik", "Redge"]
                     ]
                   else
                     []
                   end %>

    <% 25.times do |i| %>
      <tr>
        <td><%= i + 1 %></td>
        <td>
          <div class="btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-outline-primary column1-button <%= 'active' if @dnw_test.selected_words[i.to_s]&.include?("1") %>">
              <%= words_list[i][0] %> <!-- Left word -->
            </label>
          </div>
        </td>
        <td>
          <div class="btn-group-toggle" data-toggle="buttons">
            <label class="btn btn-outline-primary column2-button <%= 'active' if @dnw_test.selected_words[i.to_s]&.include?("2") %>">
              <%= words_list[i][1] %> <!-- Right word -->
            </label>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% else %>
  <p>Test was taken before test viewing was implemented, and cannot be reviewed.</p>
<% end %>






<hr>
<!--Same data, just stored in exactly same format as is on normal test page, if that is easier for the clinician to use for review -->

<h3 class="display-4 pl-2", style= 'padding-top:20px'><b>Scores Table</b></h3>
<div class="row">
<div class="col-md">
<table class="table table-sm table-bordered m1-4" style="max-width: 25rem;">
    <thead>
        <tr>
            <th scope="col">Pairs</th>
            <th scope="col">Left</th>
            <th scope="col">Right</th>
            <th scope="col">Ear Adv</th>
        </tr>
        <tbody>
            <tr>
                <th scope="row">1</th>
                <td class="left-column"><%= @dnw_test.left_score%></span>%</p></td>
                <td class="right-column"><%= @dnw_test.right_score%></span>%</td>
                <td class="ear-advantage"><%= @dnw_test.ear_advantage_score%>0</span>%</td>
            </tr>
        </tbody>
    </thead>
</table>
</div>
<div class="col-md">
    <h1><b>Dominant Ear:</b>    <%= @dnw_test.ear_advantage%></h1>
    <h2><b><center></b></center></h2>
    <h1><b>Ear Advantage Score</b> <%= @dnw_test.ear_advantage_score%>%</h1>
    <h2><b><center></b></center></h2>
</div>
<hr>

<!--this begins the backend functions to keep the test tables looking exactly as they do on the normal test page, these are taken straight from the test page so reivew that for how they work -->


<script>
    const earAdvantageCells = document.querySelectorAll('.ear-advantage');
    const percentileCells = document.querySelectorAll('.percentile');
    
    // Loop through each ear advantage cell
    earAdvantageCells.forEach(cell => {
    // Get the value of the cell
    const value = parseFloat(cell.textContent);

    // Check the value and set the background color accordingly
    if (value < 0) {
        cell.style.backgroundColor = 'lightblue';
    } else if (value > 0) {
        cell.style.backgroundColor = 'lightpink';
    } else {
        cell.style.backgroundColor = 'white';
    }
    });

    percentileCells.forEach(cell => {
    // Get the value of the cell
    const percValue = cell.textContent.trim();

    // Check the value and set the background color accordingly
    if ((percValue == "5th Percentile")) {
        cell.style.backgroundColor = 'lightpink';
    } 
    else if (percValue == "10th Percentile") {
        cell.style.backgroundColor = 'hsl(60, 100%, 70%)';
    } 
    else if (percValue == "25th Percentile") {
        cell.style.backgroundColor = 'lightgreen';
    }
    else{
        cell.style.backgroundColor = 'lightblue';
    }
    });
</script>


<style>
    .left-column {
        background-color: lightblue;
    }
    
    .right-column {
        background-color: lightpink;
    }

</style>

<hr>


